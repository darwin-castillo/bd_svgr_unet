Creación de Tablas para datamart 



CREATE TABLE CENTRO_COSTOS (
  ID_CENTRO INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  DESCRIPCION INTEGER UNSIGNED NULL
);

CREATE TABLE FECHA (
  DIA INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  MES INTEGER UNSIGNED NULL,
  AÑO INTEGER UNSIGNED NULL,
  FECHA INTEGER UNSIGNED NULL,
  INI_O_FIN INTEGER UNSIGNED NULL
);

CREATE TABLE HECHOS_I (
  PROMEDIO_SOLICITUDES INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  PRIMARY KEY(PROMEDIO_SOLICITUDES)
);

CREATE TABLE SOLICITUDES (
  ID INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  ESTADO INTEGER UNSIGNED NULL,
  DESCRIPCION INTEGER UNSIGNED NULL,
  ID_CENTRO INTEGER UNSIGNED NULL
);


Dimensión tiempo:


CREATE OR REPLACE 
PROCEDURE AGREGA_TIEMPO(VDIA NUMBER, VMES NUMBER, VANO NUMBER , N NUMBER)
IS
DECLARE VFECHA DATE;
 DECLARE ATIEMPO CURSOR FOR  SELECT(TO_INTEGER(FECHA_INI,DD), TO_INTEGER(FECHA_INI,MM), TO_INTEGER(FECHA_INI,AAAA), FECHA_INI
FROM ITEM_HISTORICO_HIS;

BEGIN
  OPEN ATIEMPO;
FETCH ATIEMPO INTO VDIA,VMES, VANO, VFECHA
FOR N IN ATIEMPO
LOOP 
   
  INSERT * INTO TIEMPO VALUES(VDIA,VMES,VANO,VFECHA,0);

  INSERT * INTO TIEMPO VALUES(VDIA,VMES,VANO,VFECHA);
   
END LOOP;

END AGREGA_TIEMPO;

Dimension Solicitudes:

CREATE SEQUENCE solicit_sq INCREMENT BY 1 START WITH 9999999;

CREATE OR REPLACE 
PROCEDURE AGREGA_SOLICITUDES(V_ESTADO NUMBER,V_DESC VARCHAR(15), V_ID_CENTRO NUMBER,N NUMBER)

IS

 DECLARE SOL CURSOR FOR  
	SELECT  HIS.SDS_ESTATUS_ETU_COD,ETU.DESCRIPCION,
  	  HIS.SDS_FORMATOS_FMO_JEFE_JEF_CENTRO_COSTO_CTR CTR “ID_CENTRO” 
	FROM 
  ITEM_HISTORICO_HIS AS HIS INNER JOIN SDS_ESTATUS_ETU AS ETU ON  HIS.SDS_ESTATUS_ETU_COD = ETU.COD;


BEGIN

  OPEN SOL ;
  FETCH SOL INTO V_ESTADO,V_DESC, V_ID_CENTRO;

FOR N IN SOL
LOOP 
   
  INSERT * INTO TIEMPO VALUES(SOLICIT_SQ.NEXTVAL,     V_ESTADO,V_DESC,V_ID_CENTRO);
   
END LOOP;   

END AGREGA_SOLICITUDES;

EXCEPTION 

 WHEN NO_DATA_FOUND THEN 
 DBMS_OUTPUT.PUT_LINE('No se encontraron registros’);






 
Dimensión Centro costo:



CREATE OR REPLACE 
PROCEDURE AGREGA_CENTRO(ID_C NUMBER, DESC VARCHAR(15), N NUMBER)

IS

 DECLARE CENTRO CURSOR FOR  
	SELECT  CTR_ID, CTR_DESCRIPCION 
	FROM SIF_CENTRO_COSTO_CTR


BEGIN

  OPEN CENTRO ;
  FETCH CENTRO INTO ID_C, DESC;

FOR N IN CENTRO
LOOP 
   
  INSERT * INTO DESC_ VALUES (ID_C,DESC);
   
END LOOP;   

END AGREGA_CENTRO;

EXCEPTION 

 WHEN NO_DATA_FOUND THEN 
 DBMS_OUTPUT.PUT_LINE('No se encontraron registros’);


	




















Tabla Hechos: 


CREATE OR REPLACE 
PROCEDURE AGREGA_CENTRO(ID_C NUMBER, DESC VARCHAR(15), N NUMBER)

IS


CREATE TABLE HECHO_2 (
  PROM_TARE_PERSONA INTEGER UNSIGNED NOT NULL,
  PRIMARY KEY(PROM_TARE_PERSONA)
);

CREATE TABLE PERSONAS (
  CEDULA INTEGER UNSIGNED NOT NULL,
  PERFIL VARCHAR(15) NULL,
  NOMBRE VARCHAR NULL,
  APELLIDO VARCHAR NULL
);

CREATE TABLE TAREAS (
  ID INTEGER UNSIGNED NOT NULL,
  DESCRIPCION VARCHAR(15) NULL,
  NOMBRE VARCHAR(15) NULL
);

CREATE TABLE TIEMPO (
  DIA INTEGER UNSIGNED NOT NULL,
  MES INTEGER UNSIGNED NULL,
  AÑO INTEGER UNSIGNED NULL,
  FECHA INTEGER UNSIGNED NULL,
  INI_O_FIN INTEGER UNSIGNED NULL
CREATE OR REPLACE 
PROCEDURE AGREGA_PER_TAREA(NOMBRE VARCHAR(15), DESC VARCHAR(15), N NUMBER)

IS

 DECLARE CPERSONA CURSOR FOR  
SELECT PER.SERVICIOS_SVO_SVO_CODIGO), SVO.SVO_NOMBRE,    SVO.SVO_DESCRIPCION
	FROM ASIGNACION_TAREA_ATA AS ATA INNER JOIN SERVICIOS_SVO AS SVO   ON
	ATA.SERVICIOS_SVO_SVO_CODIGO = SVO.SVO_CODIGO;
GROUP BY
ATA.SERVICIOS_SVO_SVO_CODIGO;
BEGIN

  OPEN CTAREA;

FOR N IN CTAREA
LOOP 
  FETCH CTAREA INTO NOMBRE, DESC; 
  INSERT * INTO DESC_ VALUES (TAREA_SQ.NEXTVAL,NOMBRE,DESC);
   
END LOOP;   


EXCEPTION 

 WHEN NO_DATA_FOUND THEN 
 DBMS_OUTPUT.PUT_LINE('No se encontraron registros’);

END AGREGA_TAREA;


CREATE SEQUENCE ED INCREMENT BY 1 START WITH 999999;

CREATE TABLE EDIFICIO(
ID INTEGER NOT NULL,
DESCRIPCION VARCHAR(15),
PRIMARY KEY(ID)
);

CREATE TABLE SDS_TIPO_MATERIALES_TML (
  TML_CODIGO INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  TML_NOMBRE CHAR(15) NULL,
  TML_DESC CHAR(15) NULL,
  PRIMARY KEY(TML_CODIGO)
);

CREATE TABLE INFORMACION_ADMINISTRATIVA_INFA (
  ID_CENTRO INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  ANO_FISCAL INTEGER UNSIGNED NOT NULL,
  PERN_TIPN_CODIGO INTEGER UNSIGNED NOT NULL,
  CEDULA INTEGER UNSIGNED NULL,
  NACIONALIDAD VARCHAR(15) NULL,
  PRIMARY KEY(ID_CENTRO, ANO_FISCAL)
);

CREATE TABLE SDS_PISOS_PSO (
  PSO_COD INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  PSO_NOMBRE CHAR(15) NULL,
  PRIMARY KEY(PSO_COD)
);

CREATE TABLE SDS_ESTATUS_ETU (
  COD INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  NOMBRE CHAR(15) NULL,
  DESCRIPCION CHAR(15) NULL,
  PRIMARY KEY(COD)
);

CREATE TABLE SDS_ORDEN_PRIORIDAD_OPA (
  OPA_CODIGO INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  OPA_NOMBRE CHAR(15) NULL,
  PRIMARY KEY(OPA_CODIGO)
);

CREATE TABLE SIF_CENTRO_COSTO_CTR (
  CTR_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  CTR_AÑO_FISCAL INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  CTR_DESCRIPCION VARCHAR(15) NULL,
  CTR_SUB_CODIGO INTEGER UNSIGNED NULL,
  CTR_SUB_UBICACION VARCHAR(15) NULL,
  CTR_TELEFONO1 VARCHAR(12) NULL,
  CTR_TELEFONO2 VARCHAR(12) NOT NULL,
  CTR_CORREO_ELECT VARCHAR(50) NULL,
  CTR_CREADO_POR VARCHAR(30) NULL,
  CTR_MODIFICADO_POR VARCHAR(30) NULL,
  CTR_FECHA_UPDATE DATE NULL,
  PRIMARY KEY(CTR_ID_CENTRO, CTR_AÑO_FISCAL)
);

CREATE TABLE ADMINIS (
  CEDULA INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  NACIONALIDAD CHAR NULL,
  PRIMARY KEY(CEDULA)
);

CREATE TABLE edificio (
  edo_codigo INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  edo_nombre VARCHAR(45) NULL,
  PRIMARY KEY(edo_codigo)
);

CREATE TABLE SDS_TIPO_SERVICIO_TSO (
  TSO_CODIGO INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO INTEGER UNSIGNED NOT NULL,
  TSO_NOMBRE CHAR(15) NOT NULL,
  TSO_DESCRIPCION CHAR(15) NOT NULL,
  PRIMARY KEY(TSO_CODIGO, SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO),
  INDEX SDS_TIPO_SERVICIO_TSO_FKIndex1(SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO),
  FOREIGN KEY(SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO)
    REFERENCES SDS_ORDEN_PRIORIDAD_OPA(OPA_CODIGO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE SERVICIOS_SVO (
  SVO_CODIGO INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  SDS_TIPO_SERVICIO_TSO_TSO_CODIGO INTEGER UNSIGNED NOT NULL,
  SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO INTEGER UNSIGNED NOT NULL,
  SVO_NOMBRE CHAR(15) NULL,
  SVO_DESCRIPCION CHAR(15) NULL,
  PRIMARY KEY(SVO_CODIGO, SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO),
  INDEX SERVICIOS_SVO_FKIndex1(SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO),
  FOREIGN KEY(SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO)
    REFERENCES SDS_TIPO_SERVICIO_TSO(TSO_CODIGO, SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE MATERIALES_MTL (
  MTL_COD INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  SDS_TIPO_MATERIALES_TML_TML_CODIGO INTEGER UNSIGNED NOT NULL,
  MTL_NOMBRE CHAR(15) NULL,
  MTL_CANTIDAD INTEGER UNSIGNED NULL,
  PRIMARY KEY(MTL_COD, SDS_TIPO_MATERIALES_TML_TML_CODIGO),
  INDEX MATERIALES_MTL_FKIndex1(SDS_TIPO_MATERIALES_TML_TML_CODIGO),
  FOREIGN KEY(SDS_TIPO_MATERIALES_TML_TML_CODIGO)
    REFERENCES SDS_TIPO_MATERIALES_TML(TML_CODIGO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE ASIGNACION_TAREA_ATA (
  ID INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO INTEGER UNSIGNED NOT NULL,
  SERVICIOS_SVO_SVO_CODIGO INTEGER UNSIGNED NOT NULL,
  MATERIALES_MTL_MTL_COD INTEGER UNSIGNED NOT NULL,
  MATERIALES_MTL_SDS_TIPO_MATERIALES_TML_TML_CODIGO INTEGER UNSIGNED NOT NULL,
  SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO INTEGER UNSIGNED NOT NULL,
  ATA_CANTIDAD INTEGER UNSIGNED NULL,
  PRIMARY KEY(ID, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SERVICIOS_SVO_SVO_CODIGO, MATERIALES_MTL_MTL_COD, MATERIALES_MTL_SDS_TIPO_MATERIALES_TML_TML_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO),
  INDEX ASIGNACION_TAREA_ATA_FKIndex1(SERVICIOS_SVO_SVO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO),
  INDEX ASIGNACION_TAREA_ATA_FKIndex2(MATERIALES_MTL_MTL_COD, MATERIALES_MTL_SDS_TIPO_MATERIALES_TML_TML_CODIGO),
  FOREIGN KEY(SERVICIOS_SVO_SVO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO)
    REFERENCES SERVICIOS_SVO(SVO_CODIGO, SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(MATERIALES_MTL_MTL_COD, MATERIALES_MTL_SDS_TIPO_MATERIALES_TML_TML_CODIGO)
    REFERENCES MATERIALES_MTL(MTL_COD, SDS_TIPO_MATERIALES_TML_TML_CODIGO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE JEF (
  JEF_CARGO INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL INTEGER UNSIGNED NOT NULL,
  CEDULA INTEGER UNSIGNED NOT NULL,
  INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL INTEGER UNSIGNED NOT NULL,
  INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  JEF_FECHA_FIN DATE NULL,
  JEF_FECHA_INI DATE NULL,
  TIPO INTEGER UNSIGNED NULL,
  NACIONALIDAD CHAR NULL,
  PRIMARY KEY(JEF_CARGO, SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, CEDULA, INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO),
  INDEX JEFE_JEF_FKIndex1(SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL),
  INDEX JEFE_JEF_FKIndex2(INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL),
  FOREIGN KEY(SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL)
    REFERENCES SIF_CENTRO_COSTO_CTR(CTR_ID_CENTRO, CTR_AÑO_FISCAL)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL)
    REFERENCES INFORMACION_ADMINISTRATIVA_INFA(ID_CENTRO, ANO_FISCAL)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE SDS_LOCALIDADES_LCD (
  LCD_COD INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL INTEGER UNSIGNED NOT NULL,
  SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  SDS_PISOS_PSO_PSO_COD INTEGER UNSIGNED NOT NULL,
  edificio_edo_codigo INTEGER UNSIGNED NOT NULL,
  LCD_NOMBRE CHAR(15) NULL,
  PRIMARY KEY(LCD_COD, SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_PISOS_PSO_PSO_COD),
  INDEX SDS_LOCALIDADES_LCD_FKIndex1(SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL),
  INDEX SDS_LOCALIDADES_LCD_FKIndex2(SDS_PISOS_PSO_PSO_COD),
  INDEX SDS_LOCALIDADES_LCD_FKIndex3(edificio_edo_codigo),
  FOREIGN KEY(SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL)
    REFERENCES SIF_CENTRO_COSTO_CTR(CTR_ID_CENTRO, CTR_AÑO_FISCAL)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(SDS_PISOS_PSO_PSO_COD)
    REFERENCES SDS_PISOS_PSO(PSO_COD)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(edificio_edo_codigo)
    REFERENCES edificio(edo_codigo)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE SDS_FORMATOS_FMO (
  FMO_COD INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL INTEGER UNSIGNED NOT NULL,
  JEF_CEDULA INTEGER UNSIGNED NOT NULL,
  JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL INTEGER UNSIGNED NOT NULL,
  JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  JEF_JEF_CARGO INTEGER UNSIGNED NOT NULL,
  FMO_FECHA DATE NULL,
  PRIMARY KEY(FMO_COD, JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, JEF_CEDULA, JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, JEF_JEF_CARGO),
  INDEX SDS_FORMATOS_FMO_FKIndex1(JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, JEF_JEF_CARGO, JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, JEF_CEDULA),
  FOREIGN KEY(JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, JEF_JEF_CARGO, JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, JEF_CEDULA)
    REFERENCES JEF(SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, JEF_CARGO, INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, CEDULA)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE PERSONAS (
  CEDULA INTEGER UNSIGNED NOT NULL,
  JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL INTEGER UNSIGNED NOT NULL,
  JEF_CEDULA INTEGER UNSIGNED NOT NULL,
  JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL INTEGER UNSIGNED NOT NULL,
  JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  JEF_CARGO INTEGER UNSIGNED NOT NULL,
  NACIONALIDAD CHAR NULL,
  NOMBRE CHAR(15) NULL AUTO_INCREMENT,
  APELLIDO CHAR(15) NULL,
  PRIMARY KEY(CEDULA),
  INDEX PERSONAS_FKIndex1(JEF_CARGO, JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, JEF_CEDULA, JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO),
  FOREIGN KEY(JEF_CARGO, JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, JEF_CEDULA, JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO)
    REFERENCES JEF(JEF_CARGO, SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, CEDULA, INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE ASIGNACION_MATERIAL_AML (
  AML_ID INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  MATERIALES_MTL_MTL_COD INTEGER UNSIGNED NOT NULL,
  MATERIALES_MTL_SDS_TIPO_MATERIALES_TML_TML_CODIGO INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_FMO_COD INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_JEF_CARGO INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_CEDULA INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  AML_CANT_ESTIMADA INTEGER UNSIGNED NULL,
  AML_CANT_USADA INTEGER UNSIGNED NULL,
  PRIMARY KEY(AML_ID, MATERIALES_MTL_MTL_COD, MATERIALES_MTL_SDS_TIPO_MATERIALES_TML_TML_CODIGO, SDS_FORMATOS_FMO_FMO_COD, SDS_FORMATOS_FMO_JEF_JEF_CARGO, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_FORMATOS_FMO_JEF_CEDULA, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO),
  INDEX ASIGNACION_MATERIAL_AML_FKIndex2(MATERIALES_MTL_MTL_COD, MATERIALES_MTL_SDS_TIPO_MATERIALES_TML_TML_CODIGO),
  INDEX ASIGNACION_MATERIAL_AML_FKIndex2(SDS_FORMATOS_FMO_FMO_COD, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, SDS_FORMATOS_FMO_JEF_CEDULA, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_FORMATOS_FMO_JEF_JEF_CARGO),
  FOREIGN KEY(MATERIALES_MTL_MTL_COD, MATERIALES_MTL_SDS_TIPO_MATERIALES_TML_TML_CODIGO)
    REFERENCES MATERIALES_MTL(MTL_COD, SDS_TIPO_MATERIALES_TML_TML_CODIGO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(SDS_FORMATOS_FMO_FMO_COD, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, SDS_FORMATOS_FMO_JEF_CEDULA, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_FORMATOS_FMO_JEF_JEF_CARGO)
    REFERENCES SDS_FORMATOS_FMO(FMO_COD, JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, JEF_CEDULA, JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, JEF_JEF_CARGO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE ASIG_PERSONAL_APL (
  APL_PERSONAL_SUGERIDO INTEGER UNSIGNED NOT NULL AUTO_INCREMENT,
  SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO INTEGER UNSIGNED NOT NULL,
  SERVICIOS_SVO_SVO_CODIGO INTEGER UNSIGNED NOT NULL,
  SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_FMO_COD INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_JEF_CARGO INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_CEDULA INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL INTEGER UNSIGNED NOT NULL,
  INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  APL_PERSONAL_USADO INTEGER UNSIGNED NULL,
  PRIMARY KEY(APL_PERSONAL_SUGERIDO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SERVICIOS_SVO_SVO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO, SDS_FORMATOS_FMO_FMO_COD, SDS_FORMATOS_FMO_JEF_JEF_CARGO, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_FORMATOS_FMO_JEF_CEDULA, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO),
  INDEX ASIG_PERSONAL_APL_FKIndex2(SERVICIOS_SVO_SVO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO),
  INDEX ASIG_PERSONAL_APL_FKIndex2(SDS_FORMATOS_FMO_FMO_COD, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, SDS_FORMATOS_FMO_JEF_CEDULA, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_FORMATOS_FMO_JEF_JEF_CARGO),
  INDEX ASIG_PERSONAL_APL_FKIndex3(INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL),
  FOREIGN KEY(SERVICIOS_SVO_SVO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO)
    REFERENCES SERVICIOS_SVO(SVO_CODIGO, SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(SDS_FORMATOS_FMO_FMO_COD, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, SDS_FORMATOS_FMO_JEF_CEDULA, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_FORMATOS_FMO_JEF_JEF_CARGO)
    REFERENCES SDS_FORMATOS_FMO(FMO_COD, JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, JEF_CEDULA, JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, JEF_JEF_CARGO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL)
    REFERENCES INFORMACION_ADMINISTRATIVA_INFA(ID_CENTRO, ANO_FISCAL)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE ITEM_HISTORICO_HIS (
  SDS_ESTATUS_ETU_COD INTEGER UNSIGNED NOT NULL,
  SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO INTEGER UNSIGNED NOT NULL,
  SERVICIOS_SVO_SVO_CODIGO INTEGER UNSIGNED NOT NULL,
  SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_FMO_COD INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_JEF_CARGO INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_CEDULA INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  HIS_FECHA_INICIO DATE NOT NULL AUTO_INCREMENT,
  HIS_OBSERVACION CHAR(15) NULL,
  HIS_FECHA_FIN DATE NULL,
  PRIMARY KEY(SDS_ESTATUS_ETU_COD, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SERVICIOS_SVO_SVO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO, SDS_FORMATOS_FMO_FMO_COD, SDS_FORMATOS_FMO_JEF_JEF_CARGO, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_FORMATOS_FMO_JEF_CEDULA, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO),
  INDEX ITEM_HISTORICO_HIS_FKIndex1(SDS_ESTATUS_ETU_COD),
  INDEX ITEM_HISTORICO_HIS_FKIndex2(SERVICIOS_SVO_SVO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO),
  INDEX ITEM_HISTORICO_HIS_FKIndex3(SDS_FORMATOS_FMO_FMO_COD, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, SDS_FORMATOS_FMO_JEF_CEDULA, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_FORMATOS_FMO_JEF_JEF_CARGO),
  FOREIGN KEY(SDS_ESTATUS_ETU_COD)
    REFERENCES SDS_ESTATUS_ETU(COD)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(SERVICIOS_SVO_SVO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO)
    REFERENCES SERVICIOS_SVO(SVO_CODIGO, SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(SDS_FORMATOS_FMO_FMO_COD, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, SDS_FORMATOS_FMO_JEF_CEDULA, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_FORMATOS_FMO_JEF_JEF_CARGO)
    REFERENCES SDS_FORMATOS_FMO(FMO_COD, JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, JEF_CEDULA, JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, JEF_JEF_CARGO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

CREATE TABLE ITEMS_ITM (
  ITM_ID INTEGER UNSIGNED NOT NULL,
  ASIGNACION_MATERIAL_AML_MATERIALES_MTL_SDS_TIPO_MATERIALES_TML_TML_CODIGO INTEGER UNSIGNED NOT NULL,
  ASIGNACION_MATERIAL_AML_MATERIALES_MTL_MTL_COD INTEGER UNSIGNED NOT NULL,
  ASIGNACION_MATERIAL_AML_AML_ID INTEGER UNSIGNED NOT NULL,
  SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO INTEGER UNSIGNED NOT NULL,
  SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO INTEGER UNSIGNED NOT NULL,
  SERVICIOS_SVO_SVO_CODIGO INTEGER UNSIGNED NOT NULL,
  SDS_LOCALIDADES_LCD_SDS_PISOS_PSO_PSO_COD INTEGER UNSIGNED NOT NULL,
  SDS_LOCALIDADES_LCD_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  SDS_LOCALIDADES_LCD_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL INTEGER UNSIGNED NOT NULL,
  SDS_LOCALIDADES_LCD_LCD_COD INTEGER UNSIGNED NOT NULL,
  ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_FMO_COD INTEGER UNSIGNED NOT NULL,
  ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL INTEGER UNSIGNED NOT NULL,
  ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_CEDULA INTEGER UNSIGNED NOT NULL,
  ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL INTEGER UNSIGNED NOT NULL,
  ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_JEF_CARGO INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_JEF_CARGO INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_CEDULA INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO INTEGER UNSIGNED NOT NULL,
  SDS_FORMATOS_FMO_FMO_COD INTEGER UNSIGNED NOT NULL,
  ITM_OBSERVACION CHAR(15) NOT NULL AUTO_INCREMENT,
  PRIMARY KEY(ITM_ID, ASIGNACION_MATERIAL_AML_MATERIALES_MTL_SDS_TIPO_MATERIALES_TML_TML_CODIGO, ASIGNACION_MATERIAL_AML_MATERIALES_MTL_MTL_COD, ASIGNACION_MATERIAL_AML_AML_ID, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SERVICIOS_SVO_SVO_CODIGO, SDS_LOCALIDADES_LCD_SDS_PISOS_PSO_PSO_COD, SDS_LOCALIDADES_LCD_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_LOCALIDADES_LCD_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_LOCALIDADES_LCD_LCD_COD, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_FMO_COD, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_CEDULA, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_JEF_CARGO),
  INDEX ITEMS_ITM_FKIndex1(ASIGNACION_MATERIAL_AML_AML_ID, ASIGNACION_MATERIAL_AML_MATERIALES_MTL_MTL_COD, ASIGNACION_MATERIAL_AML_MATERIALES_MTL_SDS_TIPO_MATERIALES_TML_TML_CODIGO, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_FMO_COD, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_JEF_CARGO, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_CEDULA, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO),
  INDEX ITEMS_ITM_FKIndex2(SERVICIOS_SVO_SVO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO),
  INDEX ITEMS_ITM_FKIndex3(SDS_LOCALIDADES_LCD_LCD_COD, SDS_LOCALIDADES_LCD_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_LOCALIDADES_LCD_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_LOCALIDADES_LCD_SDS_PISOS_PSO_PSO_COD),
  INDEX ITEMS_ITM_FKIndex4(SDS_FORMATOS_FMO_FMO_COD, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, SDS_FORMATOS_FMO_JEF_CEDULA, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_FORMATOS_FMO_JEF_JEF_CARGO),
  FOREIGN KEY(ASIGNACION_MATERIAL_AML_AML_ID, ASIGNACION_MATERIAL_AML_MATERIALES_MTL_MTL_COD, ASIGNACION_MATERIAL_AML_MATERIALES_MTL_SDS_TIPO_MATERIALES_TML_TML_CODIGO, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_FMO_COD, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_JEF_CARGO, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_CEDULA, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, ASIGNACION_MATERIAL_AML_SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO)
    REFERENCES ASIGNACION_MATERIAL_AML(AML_ID, MATERIALES_MTL_MTL_COD, MATERIALES_MTL_SDS_TIPO_MATERIALES_TML_TML_CODIGO, SDS_FORMATOS_FMO_FMO_COD, SDS_FORMATOS_FMO_JEF_JEF_CARGO, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_FORMATOS_FMO_JEF_CEDULA, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(SERVICIOS_SVO_SVO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SERVICIOS_SVO_SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO)
    REFERENCES SERVICIOS_SVO(SVO_CODIGO, SDS_TIPO_SERVICIO_TSO_TSO_CODIGO, SDS_TIPO_SERVICIO_TSO_SDS_ORDEN_PRIORIDAD_OPA_OPA_CODIGO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(SDS_LOCALIDADES_LCD_LCD_COD, SDS_LOCALIDADES_LCD_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_LOCALIDADES_LCD_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_LOCALIDADES_LCD_SDS_PISOS_PSO_PSO_COD)
    REFERENCES SDS_LOCALIDADES_LCD(LCD_COD, SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_PISOS_PSO_PSO_COD)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION,
  FOREIGN KEY(SDS_FORMATOS_FMO_FMO_COD, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, SDS_FORMATOS_FMO_JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, SDS_FORMATOS_FMO_JEF_CEDULA, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, SDS_FORMATOS_FMO_JEF_JEF_CARGO)
    REFERENCES SDS_FORMATOS_FMO(FMO_COD, JEF_INFORMACION_ADMINISTRATIVA_INFA_ID_CENTRO, JEF_INFORMACION_ADMINISTRATIVA_INFA_ANO_FISCAL, JEF_CEDULA, JEF_SIF_CENTRO_COSTO_CTR_CTR_AÑO_FISCAL, JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO, JEF_JEF_CARGO)
      ON DELETE NO ACTION
      ON UPDATE NO ACTION
);

SELECT 
   SUM(HIS.HIS_FECHA_FIN - HIS.HIS_FECHA_INICIO)/COUNT(HIS.HIS_FECHA_FIN - HIS.HIS_FECHA_INICIO) 
FROM 
  ITEM_HISTORICO_HIS AS HIS INNER JOIN SDS_ESTATUS_ETU AS ETU ON HIS.SDS_ESTATUS_ETU_COD = ETU.COD
  SDS_FORMATOS_FMO AS FMO INNER JOIN  JEFE_JEF  AS JEF 
  ON 
  FMO.JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO = JEF.SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO
  SIF_CENTRO_COSTO_CTR AS CTR INNER JOIN JEFE_JEF AS JEF 
  ON 
  JEF.SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO = CTR.CTR_ID_CENTRO
WHERE
  HIS.SDS_FORMATOS_FMO_JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRP = FMO.JEF_SIF_CENTRO_COSTO_CTR_CTR_ID_CENTRO
GROUP BY HIS.FMO_CODIGO

CREATE OR REPLACE 
PROCEDURE agrega_tiempo(VDIA NUMBER, VMES NUMBER, VANO NUMBER , N NUMBER)
IS
DECLARE VFECHA DATE;
 DECLARE ATIEMPO CURSOR FOR  SELECT(TO_INTEGER(FECHA_INI,DD), TO_INTEGER(FECHA_INI,MM), TO_INTEGER(FECHA_INI,AAAA), FECHA_INI
FROM ITEM_HISTORICO_HIS;

BEGIN
  OPEN ATIEMPO;
FETCH ATIEMPO INTO VDIA,VMES, VANO, VFECHA
FOR N IN ATIEMPO
LOOP 
   
  INSERT * INTO TIEMPO VALUES(VDIA,VMES,VANO,VFECHA,0);

  INSERT * INTO TIEMPO VALUES(VDIA,VMES,VANO,VFECHA);
   
END LOOP;

END agrega_tiempo;

 







Dimension Solicitudes:

CREATE SEQUENCE solicit_sq INCREMENT BY 1 START WITH 9999999;

CREATE OR REPLACE 
PROCEDURE agrega_solicitudes(V_ESTADO NUMBER,V_DESC VARCHAR(15), V_ID_CENTRO NUMBER,N NUMBER)

IS

 DECLARE SOL CURSOR FOR  
  SELECT  HIS.SDS_ESTATUS_ETU_COD,ETU.DESCRIPCION,
  	  HIS.SDS_FORMATOS_FMO_JEFE_JEF_CENTRO_COSTO_CTR CTR “ID_CENTRO” 
	FROM 
  ITEM_HISTORICO_HIS AS HIS INNER JOIN SDS_ESTATUS_ETU AS ETU ON  HIS.SDS_ESTATUS_ETU_COD = ETU.COD;


BEGIN

  OPEN SOL ;
  FETCH SOL INTO V_ESTADO,V_DESC, V_ID_CENTRO;

FOR N IN SOL
LOOP 
   
  INSERT * INTO TIEMPO VALUES(SOLICIT_SQ.NEXTVAL,     V_ESTADO,V_DESC,V_ID_CENTRO);
   
END LOOP;   

END agrega_tiempo;

EXCEPTION 

 WHEN NO_DATA_FOUND THEN 
 DBMS_OUTPUT.PUT_LINE('No se encontraron registros’);


 
